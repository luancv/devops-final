- name: Copy deployment configuration
  copy:
    src: "{{ ENVIRONMENT_NAME }}-deployment.yaml"
    dest: $HOME
- name: download
  shell: "curl -o aws-iam-authenticator curl -o aws-iam-authenticator https://amazon-eks.s3-us-west-2.amazonaws.com/1.13.7/2019-06-11/bin/linux/amd64/aws-iam-authenticator"
  args:
    chdir: $HOME
- name: Permission
  shell: "chmod +x ./aws-iam-authenticator"
  args:
    chdir: $HOME
- name: mv
  shell: "sudo mv ./aws-iam-authenticator /usr/local/bin/aws-iam-authenticator"
  args:
    chdir: $HOME
- name: aws_access_key_id
  shell: aws configure set aws_access_key_id {{AWS_ACCESS_KEY_ID}
  args:
    chdir: $HOME
- name: AWS_SECRET_ACCESS_KEY
  shell: aws configure set aws_secret_access_key {AWS_SECRET_ACCESS_KEY}}
  args:
    chdir: $HOME         
- name: region
  shell: aws configure set region {{AWS_DEFAULT_REGION}}
  args:
    chdir: $HOME         
- name: update-kubeconfig
  shell: aws eks --region us-east-1 update-kubeconfig --name final-cluster
  args:
    chdir: $HOME
- name: Apply deployment configuration
  shell: "./bin/kubectl apply -f {{ ENVIRONMENT_NAME }}-deployment.yaml"
  args:
    chdir: $HOME




